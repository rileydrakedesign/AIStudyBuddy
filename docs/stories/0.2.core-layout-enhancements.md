# Story 0.2: Core Layout Enhancements - Brownfield Addition

## Status

**âœ… COMPLETED** (v1.2 - Implemented and merged to main)

### Implementation Summary

**Commits:**
- `52031d12` - Main implementation commit
- `277bd7d6` - Merge to main

**What Was Implemented:**
- âœ… ChatSidebar component extracted from Chat.tsx
- âœ… Recent Chats section with class badges and "View More" expansion
- âœ… Class-scoped collapsible sections (Chats, Study Guides, Documents)
- âœ… "No Classes" state with "Create Your First Class" button
- âœ… MobileBlockingPage component with device detection
- âœ… Visual design (8px border radius, 300ms animations, hover states)
- âœ… Inline chat naming (Enter/blur to save, no buttons)
- âœ… Inline chat editing with pencil icons
- âœ… Backend PATCH endpoint for chat session updates
- âœ… Chat rename without page reload

**Deviations from Original Story:**
- Home icon removed from class dropdown (user preference)
- Settings icon not implemented (not needed at this stage)

---

## Story

**As a** student user,
**I want** an enhanced sidebar with class selection, organized sections, and a mobile blocking page,
**so that** I can navigate my materials more efficiently on desktop while being informed about mobile support status.

---

## Story Context

**Existing System Integration:**

- Integrates with: Existing Chat.tsx page (`frontend/src/pages/Chat.tsx`), Header component (`frontend/src/components/Header.tsx`)
- Technology: React 18.3.1 + Material UI 6.1.9 + TailwindCSS 3.4.15
- Follows pattern: Existing Material UI component patterns in Chat.tsx (List, ListItem, Collapse, etc.)
- Touch points: Chat page sidebar area (currently renders classes/documents/chats directly), App.tsx routing (for mobile blocking)

---

## Visual Mockup

### Enhanced Sidebar Layout (With Classes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  classchat        [AI]                  â”‚  â† Header (unchanged)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â–¼ Recent Chats                    â“˜   â”‚  â† Collapsible section
â”‚  â”œâ”€ Chat about algorithms    [CS 101]  â”‚     Shows 5 most recent
â”‚  â”œâ”€ Physics homework help     [PHY 1]  â”‚     across all classes
â”‚  â”œâ”€ Study guide review        [CS 101] â”‚     with class chips
â”‚  â”œâ”€ Exam prep questions       [MATH]   â”‚
â”‚  â””â”€ Literature analysis        [ENG]   â”‚
â”‚                                         â”‚
â”‚  [View More...]                         â”‚  â† Expand to show all chats
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [ğŸ ] CS 101 - Data Structures    [âš™]  â”‚  â† Class dropdown selector
â”‚                                         â”‚     (styled like inspiration)
â”‚     â–¼ Chats                        [+] â”‚  â† Collapsible, class-scoped
â”‚     â”œâ”€ Chat about algorithms      [Ã—]  â”‚     Delete on hover
â”‚     â”œâ”€ Midterm review             [Ã—]  â”‚     Active chat highlighted
â”‚     â””â”€ Homework questions         [Ã—]  â”‚
â”‚                                         â”‚
â”‚     â–¼ Study Guides                 [+] â”‚  â† Collapsible (UI placeholder)
â”‚     â”œâ”€ Algorithms cheat sheet         â”‚     Same look as Documents
â”‚     â””â”€ Final exam review              â”‚     No click-through yet
â”‚                                         â”‚
â”‚     â–¼ Documents                    [+] â”‚  â† Collapsible, class-scoped
â”‚     â”œâ”€ ğŸ“„ Lecture 1 - Intro.pdf       â”‚     Same behavior as current
â”‚     â”œâ”€ ğŸ“„ Chapter 3 - Arrays.pdf      â”‚     Opens document viewer
â”‚     â””â”€ ğŸ“„ Assignment 2.pdf            â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â–¼ Other Classes                  â”‚  â”‚  â† Dropdown menu when clicked
â”‚  â”‚   PHY 101 - Physics              â”‚  â”‚
â”‚  â”‚   MATH 101 - Calculus            â”‚  â”‚
â”‚  â”‚   ENG 101 - Literature           â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚  â”‚
â”‚  â”‚   [+] New Class                  â”‚  â”‚  â† At bottom of dropdown
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ rileydrake@ucsb.edu                â”‚  â† User profile (unchanged)
â”‚     Free Plan                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Enhanced Sidebar Layout (No Classes - First Time User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  classchat        [AI]                  â”‚  â† Header (unchanged)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â–¼ Recent Chats                    â“˜   â”‚  â† Empty state or hidden
â”‚     (No chats yet)                      â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [+] Create Your First Class     â”‚  â”‚  â† Replaces class dropdown
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     when no classes exist
â”‚                                         â”‚
â”‚                                         â”‚
â”‚  Get started by creating a class        â”‚
â”‚  to organize your study materials.      â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ rileydrake@ucsb.edu                â”‚  â† User profile (unchanged)
â”‚     Free Plan                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Visual Design Elements

**Inspired by ChatEDU sidebar:**
- Class selector styled as dropdown button with home icon and settings icon
- Collapsible sections with chevron indicators (â–¼/â–º)
- Clean section grouping with subtle dividers
- Add buttons [+] aligned to the right of expandable sections

**Preserving Class Chat AI patterns:**
- "classchat AI" header with blue badge
- Dark background theme
- User profile section at bottom
- Delete [Ã—] buttons on hover for chat items
- Active chat highlighting

**Component Hierarchy:**
1. **Recent Chats Section** (Material UI Collapse)
   - Expandable/collapsible with chevron
   - Chat items with Material UI Chip for class badges
   - "View More" button expands to show all chats

2. **Class Selector** (Material UI Select styled as button)
   - Displays selected class with icons
   - Dropdown shows all classes + "New Class" option
   - Replaces with "New Class" button when no classes exist

3. **Class-Scoped Sections** (Material UI Collapse for each)
   - Chats: Existing behavior (delete on hover, active highlighting)
   - Study Guides: UI placeholder, same styling as Documents
   - Documents: Existing behavior (opens document viewer)

4. **User Profile** (unchanged)

---

## Acceptance Criteria

### Functional Requirements

1. **Enhanced Sidebar - Recent Chats Section (Top)**
   - Collapsible section at TOP of sidebar (Material UI Collapse component)
   - Shows 5 most recent chats across ALL classes by default
   - Each chat item displays small colored chip with class code (e.g., "CS 101")
   - "View More..." button expands to show all recent chats (up to 10)
   - Class badges use Material UI Chip component with class-specific colors
   - Clicking chat loads chat session in main area (existing behavior preserved)
   - Delete button [Ã—] appears on hover for each chat item

2. **Enhanced Sidebar - Class Dropdown Selector**
   - Material UI Select component styled as button (inspired by ChatEDU)
   - Displays selected class with home icon [ğŸ ] and settings icon [âš™]
   - Dropdown shows all user classes plus "New Class" option at bottom
   - When NO classes exist: Replace dropdown with "Create Your First Class" button
   - Selecting different class switches all class-scoped sections below

3. **Enhanced Sidebar - Class-Scoped Collapsible Sections**
   - Three collapsible accordion sections under selected class (Material UI Collapse):
     - **"Chats"** - shows only chats for selected class
       - Existing behavior: delete [Ã—] on hover, active chat highlighted
       - Add button [+] to create new chat for this class
     - **"Study Guides"** - UI placeholder section (no functionality yet)
       - Same styling as Documents section
       - Clicking shows placeholder toast "Study Guides coming soon"
       - Add button [+] shown but disabled
     - **"Documents"** - shows only documents for selected class
       - Existing behavior: clicking opens document viewer in right panel
       - Add button [+] to upload new document for this class
   - Each section can be expanded/collapsed independently
   - Expansion state persists during session (React state, not localStorage)

4. **Enhanced Sidebar - Visual Design**
   - Border radius: 8px for all section containers
   - Animations: 300ms ease-in-out for expand/collapse transitions
   - Hover states: Background color change on hover (rgba(255, 255, 255, 0.08))
   - Chevron indicators (â–¼/â–º) for collapsible sections
   - Add buttons [+] aligned to right of section headers
   - Follows existing Material UI theme (primary blue/purple colors)
   - Clean dividers between major sections (Recent Chats | Class Sections | User Profile)

5. **Enhanced Sidebar - No Classes State**
   - When user has no classes created yet:
     - Recent Chats section empty or hidden
     - Class dropdown replaced with "Create Your First Class" button
     - Helper text: "Get started by creating a class to organize your study materials."
   - Clicking button opens class creation modal/flow

6. **Mobile Blocking Page**
   - Detects mobile via `navigator.userAgent` or viewport width <768px
   - Shows blocking page instead of app router when mobile detected
   - Page contains:
     - Class Chat AI logo at top
     - ğŸ“± icon with "Mobile Not Supported Yet" heading (Typography h4)
     - Explanation text: "Class Chat AI requires a desktop browser for the best experience. Please visit on your laptop or desktop computer."
     - Two Material UI buttons: "Learn More" (link to #) and "Email Me a Link" (placeholder toast)
   - Implemented in App.tsx wrapping existing Router component

### Integration Requirements

1. Existing chat session loading (getUserChatSessions, createChatSession) continues to work unchanged
2. Existing class/document fetching (getUserClasses, getClassDocuments) continues to work unchanged
3. New sidebar layout follows existing Material UI List/ListItem pattern from Chat.tsx:189-350
4. Integration with existing WebSocket for document processing status maintained
5. Recent Chats section queries all chats across classes and sorts by most recent
6. Class-scoped sections filter data by selected class ID

### Quality Requirements

1. Changes are covered by manual testing (no automated tests required for UI)
2. Documentation updated in code comments for new sidebar components
3. No regression in existing chat/document functionality verified through manual testing
4. Study Guides section clearly marked as placeholder (toast message on click)
5. All collapsible sections have smooth animations (300ms transitions)

---

## Technical Notes

**Integration Approach:**
- Refactor existing sidebar in Chat.tsx (lines 400-600 estimated) into new component `<EnhancedSidebar>`
- Use existing state management pattern (useState hooks for sidebar state)
- Leverage existing Material UI imports (Select, Collapse, List, Chip already imported in Chat.tsx)
- Mobile blocking wraps `<Router>` in App.tsx with device detection HOC or conditional render

**Existing Pattern Reference:**
- Chat.tsx:189-350 shows existing sidebar structure with collapsible sections using `<Collapse>` and `<ExpandMore>`/`<ExpandLess>` icons
- Header.tsx:51-63 shows existing sidebar toggle pattern with transition animations
- Existing Material UI theme in main.tsx defines primary colors and spacing

**Key Constraints:**
- Must maintain existing WebSocket connection for document processing (initializeSocket in Chat.tsx:51)
- Must preserve existing chat message history loading (messages state)
- Must not break existing document viewer (DocumentChat component)
- Mobile blocking must be easily removable when mobile support is added later (feature flag pattern)

**Implementation Approach:**
1. Create `<EnhancedSidebar>` component extracting sidebar logic from Chat.tsx
2. Add Recent Chats section at top (Material UI Collapse + Chip components)
3. Create class dropdown selector styled as button (Material UI Select)
4. Implement class-scoped collapsible sections (Chats, Study Guides, Documents)
5. Add state management for selected class and section expansion states
6. Implement "No Classes" state with "Create Your First Class" button
7. Create `<MobileBlockingPage>` component
8. Add mobile detection in App.tsx wrapping Router

**Estimated Complexity:** 6-8 hours
- Sidebar refactor: 4-5 hours
- Mobile blocking: 1-2 hours
- Testing and polish: 1 hour

---

## Definition of Done

- [ ] Recent Chats section renders at TOP of sidebar with class badges
- [ ] Recent Chats shows 5 most recent by default with "View More" button
- [ ] Class dropdown selector displays with home and settings icons (ChatEDU style)
- [ ] Selecting class switches all class-scoped sections (Chats, Study Guides, Documents)
- [ ] "No Classes" state shows "Create Your First Class" button instead of dropdown
- [ ] Class-scoped Chats section shows only chats for selected class
- [ ] Class-scoped Documents section shows only documents for selected class
- [ ] Study Guides section renders as UI placeholder (toast on click: "Study Guides coming soon")
- [ ] All sections collapsible/expandable with chevron indicators
- [ ] Add buttons [+] shown on section headers (aligned right)
- [ ] Delete buttons [Ã—] appear on hover for chat items
- [ ] Active chat highlighted in both Recent Chats and class-scoped Chats
- [ ] Visual design matches specifications (8px border radius, 300ms animations, hover states)
- [ ] Mobile blocking page displays on viewport <768px
- [ ] Existing chat functionality regression tested (load chat, send message, citations)
- [ ] Existing document viewer functionality regression tested (open document, view PDF)
- [ ] Code follows existing patterns and standards
- [ ] No console errors or warnings

---

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Refactoring sidebar breaks existing chat/document interactions
- **Mitigation:** Extract sidebar incrementally, test after each component extraction, preserve all existing props/callbacks
- **Rollback:** Revert sidebar extraction, restore original Chat.tsx sidebar code (git checkout Chat.tsx)

**Compatibility Verification:**

- [ ] No breaking changes to existing APIs (frontend only)
- [ ] Database changes: None (no backend changes)
- [ ] UI changes follow existing design patterns (Material UI components, existing theme)
- [ ] Performance impact is negligible (collapsible sections use existing Collapse component)

---

## Dev Notes

### Integration Points
- Chat.tsx sidebar area (lines 400-600 estimated)
- App.tsx Router wrapping (for mobile blocking)
- Existing getUserClasses, getClassDocuments, getUserChatSessions API calls
- Existing DocumentChat component (document viewer)
- Existing WebSocket connection (Socket.IO)

### Dependencies
- Material UI 6.1.9 (Select, Collapse, List, Chip, Typography components)
- React 18.3.1 (useState, useEffect hooks)
- Existing API communicators (getUserClasses, getClassDocuments, getUserChatSessions)
- Existing theme configuration (main.tsx)

### Testing Checklist
- [ ] Recent Chats section at top shows 5 most recent chats with class badges
- [ ] "View More" button in Recent Chats expands to show all chats
- [ ] Class dropdown shows all user classes with "New Class" at bottom
- [ ] "No Classes" state shows "Create Your First Class" button correctly
- [ ] Selecting different class updates all class-scoped sections
- [ ] Chats section shows only chats for selected class
- [ ] Documents section shows only documents for selected class
- [ ] Study Guides section shows placeholder toast on click
- [ ] All sections expand/collapse with smooth 300ms animations
- [ ] Add buttons [+] appear on section headers
- [ ] Delete buttons [Ã—] appear on hover for chat items
- [ ] Active chat highlighted in both sections
- [ ] Clicking document opens document viewer
- [ ] Clicking chat loads chat session
- [ ] Mobile blocking page shows on mobile viewport (<768px)
- [ ] Desktop users see normal app
- [ ] No console errors
- [ ] Existing WebSocket events still work (document-ready, chunk-streamed)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Story created from UI Enhancement Goals PRD | John (PM Agent) |
| 2025-10-27 | 1.1 | Added visual mockup and updated AC to align with new sidebar design | BMad Orchestrator |
| 2025-10-28 | 1.2 | Story completed and merged to main (commit 52031d12) | Claude Code |

---

## Previous Story Reference

**Story 0.1:** Local Development Environment Setup & Configuration (COMPLETED)

---

*ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)*

*Co-Authored-By: Claude <noreply@anthropic.com>*
